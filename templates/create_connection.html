{% extends 'layout.html' %}
{% block head %}
<script>

        $(document).ready(function () {
        document.getElementById('createEspButton').addEventListener('click',
            function(event) {
                event.preventDefault();
                var myModalEl = document.querySelector('#espmodal');
                var modal = bootstrap.Modal.getOrCreateInstance(myModalEl); // Returns a Bootstrap modal instance
                modal.show();


                $.ajax({
                  url: "{{ 'create_encyrpt/espForm' }}",
                  context: document.body
                }).done(function(data) {
                  $( '#espmodalBody' ).html(data);
                  $('#espForm').submit(function(e){
                    e.preventDefault();
                    serialized = $(this).serializeArray();
                    var data = {};
                    for(s in serialized){
                        data[serialized[s]['name']] = serialized[s]['value']
                    }
                    text = "";
                    if (data.encryption.trim() != "null") {
                        text += data.encryption.replace(/\s.*$/g,"").trim();
                        if (data.integrity.trim() != "none") {
                            text += "-" + data.integrity.replace(/\s.*$/g,"").trim();
                            if (data.dh_group.trim() != "none") {
                                text += "-" + data.dh_group.replace(/\s.*$/g,"").trim();
                            }
                        }
                    }
                    $("#espProgress").remove();
                    $("#esp_proposals").val(text);
                  });
                });
                // Handle the form data
        });
        });
</script>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row">
            <h1>Create Site To Site IKEV1 Connection</h1>
        </div>
        <div class="row">
            <form method="post" action="/" enctype="multipart/form-data">
                {{ form.csrf_token }}
                <p>{{ form.name.label }} {{ form.name() }}</p>
                <p>{{ form.local_addrs.label }} {{ form.local_addrs() }}</p>
                <p>{{ form.remote_addrs.label }} {{ form.remote_addrs() }}</p>
                <p>{{ form.local_port.label }} {{ form.local_port() }}</p>
                <p>{{ form.remote_port.label }} {{ form.remote_port() }}</p>
                <p>{{ form.proposals.label }} {{ form.proposals() }}
                <button id="createIkeButton">Choose IKE</button>
                </p>
                <p>{{ form.vips.label }} {{ form.vips() }}</p>
                <p>{{ form.aggressive.label }} {{ form.aggressive() }}</p>
                <p>{{ form.pull.label }} {{ form.pull() }}</p>
                <p>{{ form.dscp.label }} {{ form.dscp() }}</p>
                <p>{{ form.encap.label }} {{ form.encap() }}</p>
                <p>{{ form.dpd_delay.label }} {{ form.dpd_delay() }}</p>
                <p>{{ form.dpd_timeout.label }} {{ form.dpd_timeout() }}</p>
                <p>{{ form.fragmentation.label }} {{ form.fragmentation() }}</p>
                <p>{{ form.keyingtries.label }} {{ form.keyingtries() }}</p>
                <p>{{ form.unique.label }} {{ form.unique() }}</p>
                <p>{{ form.reauth_time.label }} {{ form.reauth_time() }}</p>
                <p>{{ form.rekey_time.label }} {{ form.rekey_time() }}</p>
                <p>{{ form.over_time.label }} {{ form.over_time() }}</p>

                <h3>Local Auth</h3>
                <p>{{ form.local_round.label }} {{ form.local_round() }}</p>
                <p>{{ form.local_auth.label }} {{ form.local_auth() }}</p>
                <p>{{ form.local_id.label }} {{ form.local_id() }}</p>

                <h3>Remote Auth</h3>
                <p>{{ form.remote_round.label }} {{ form.remote_round() }}</p>
                <p>{{ form.remote_auth.label }} {{ form.remote_auth() }}</p>
                <p>{{ form.remote_id.label }} {{ form.remote_id() }}</p>

                <h3>Children</h3>
                <p>{{ form.esp_proposals.label }} {{ form.esp_proposals() }}
                <button id="createEspButton">Choose ESP</button>
                </p>



                <p>{{ form.authby.label }} {{ form.authby() }}</p>
                <p>{{ form.auto.label }} {{ form.auto() }}</p>
                <p>{{ form.closeaction.label }} {{ form.closeaction() }}</p>
                <p>{{ form.compress.label }} {{ form.compress() }}</p>
                <p>{{ form.dpdaction.label }} {{ form.dpdaction() }}</p>
                <p>{{ form.dpddelay.label }} {{ form.dpddelay() }}</p>
                <p>{{ form.dpdtimeout.label }} {{ form.dpdtimeout() }}</p>
                <p>{{ form.inactivity.label }} {{ form.inactivity() }}</p>
                <p>{{ form.forceencaps.label }} {{ form.forceencaps() }}</p>
                <p>{{ form.ike_encryption.label }} {{ form.ike_encryption() }}</p>
                <p>{{ form.ike_integrity.label }} {{ form.ike_integrity() }}</p>
                <p>{{ form.ike_dh_group.label }} {{ form.ike_dh_group() }}</p>
                <p>{{ form.ikelifetime.label }} {{ form.ikelifetime() }}</p>
                <p>{{ form.installpolicy.label }} {{ form.installpolicy() }}</p>
                <p>{{ form.keyexchange.label }} {{ form.keyexchange() }}</p>
                <p>{{ form.lifetime.label }} {{ form.lifetime() }}</p>
                <p>{{ form.marginbytes.label }} {{ form.marginbytes() }}</p>
                <p>{{ form.marginpackets.label }} {{ form.marginpackets() }}</p>
                <p>{{ form.margintime.label }} {{ form.margintime() }}</p>
                <p>{{ form.mark.label }} {{ form.mark() }}</p>
                <p>{{ form.mark_in.label }} {{ form.mark_in() }}</p>
                <p>{{ form.mark_out.label }} {{ form.mark_out() }}</p>
                <p>{{ form.modeconfig.label }} {{ form.modeconfig() }}</p>
                <p>{{ form.reauth.label }} {{ form.reauth() }}</p>
                <p>{{ form.rekey.label }} {{ form.rekey() }}</p>
                <p>{{ form.rekeyfuzz.label }} {{ form.rekeyfuzz() }}</p>
                <p>{{ form.replay_window.label }} {{ form.replay_window() }}</p>
                <p>{{ form.reqid.label }} {{ form.reqid() }}</p>
                <p>{{ form.sha256_96.label }} {{ form.sha256_96() }}</p>
                <p>{{ form.tfc.label }} {{ form.tfc() }}</p>
                <p>{{ form.type.label }} {{ form.type() }}</p>

                <h3>left|right End Parameters</h3>
                <p>{{ form.left.label }} {{ form.left() }}</p>
                <p>{{ form.right.label }} {{ form.right() }}</p>
                <p>{{ form.leftallowany.label }} {{ form.leftallowany() }}</p>
                <p>{{ form.rightallowany.label }} {{ form.rightallowany() }}</p>
                <p>{{ form.leftfirewall.label }} {{ form.leftfirewall() }}</p>
                <p>{{ form.rightfirewall.label }} {{ form.rightfirewall() }}</p>
                <p>{{ form.leftgroups.label }} {{ form.leftgroups() }}</p>
                <p>{{ form.rightgroups.label }} {{ form.rightgroups() }}</p>
                <p>{{ form.lefthostaccess.label }} {{ form.lefthostaccess() }}</p>
                <p>{{ form.righthostaccess.label }} {{ form.righthostaccess() }}</p>
                <p>{{ form.leftsourceip.label }} {{ form.leftsourceip() }}</p>
                <p>{{ form.rightsourceip.label }} {{ form.rightsourceip() }}</p>
                <p>{{ form.leftsubnet.label }} {{ form.leftsubnet() }}</p>
                <p>{{ form.rightsubnet.label }} {{ form.rightsubnet() }}</p>
                <p>{{ form.leftupdown.label }} {{ form.leftupdown() }}</p>
                <p>{{ form.rightupdown.label }} {{ form.rightupdown() }}</p>


                <p><input type="submit" value="Submit"></p>
            </form>
        </div>
    </div>

    <div class="modal" id="espmodal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Choose ESP</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="espmodalBody" >

            <div class="progress" id="espProgress">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
{% endblock %}